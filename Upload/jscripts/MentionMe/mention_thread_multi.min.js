var MentionMe=(function(m){var spinner;function init(){var element,post_ids,mentioned=Cookie.get("multi_mention");if(mentioned){post_ids=mentioned.split("|");post_ids.each(function(post_id){if($("multi_mention_"+post_id)){element=$("multi_mention_"+post_id);element.src=element.src.replace("postbit_multi_mention.gif","postbit_multi_mention_on.gif");}
if($("multi_mention_link_"+post_id)){element=$("multi_mention_link_"+post_id);element.addClassName('postbit_multimention_on');}});if($('quickreply_multi_mention')){$('quickreply_multi_mention').show();}}
return true;}
function mention(pid){var element,new_post_ids=new Array(),mentioned=Cookie.get("multi_mention"),is_new=true,post_ids;if(mentioned){post_ids=mentioned.split("|");post_ids.each(function(post_id){if(post_id!=pid&&post_id!=''){new_post_ids[new_post_ids.length]=post_id;}else if(post_id==pid){is_new=false;}});}
if(is_new==true){new_post_ids[new_post_ids.length]=pid;}
if($("multi_mention_"+pid)){element=$("multi_mention_"+pid);if(is_new==true){element.src=element.src.replace("postbit_multi_mention.gif","postbit_multi_mention_on.gif");}else{element.src=element.src.replace("postbit_multi_mention_on.gif","postbit_multi_mention.gif");}}
if($("multi_mention_link_"+pid)){element=$("multi_mention_link_"+pid);if(is_new==true){element.addClassName('postbit_multimention_on');}else{element.removeClassName('postbit_multimention_on');}}
if($('quickreply_multi_mention')){if(new_post_ids.length>0){$('quickreply_multi_mention').show();}else{$('quickreply_multi_mention').hide();}}
Cookie.set("multi_mention",new_post_ids.join("|"));}
function load(){if(use_xmlhttprequest==1){spinner=new ActivityIndicator("body",{image:imagepath+"/spinner_big.gif"});new Ajax.Request('xmlhttp.php',{method:'get',parameters:{action:'mentionme',mode:'get_multi_mentioned',load_all:1},onComplete:insert});return false;}
return true;}
function insert(transport){var id,message;if(transport.responseText.match(/<error>(.*)<\/error>/)){message=transport.responseText.match(/<error>(.*)<\/error>/);if(!message[1]){message[1]="An unknown error occurred.";}
if(spinner){spinner.destroy();spinner='';}
alert('There was an error fetching the posts.\n\n'+message[1]);}else if(transport.responseText){id='message';if(typeof clickableEditor!='undefined'){id=clickableEditor.textarea;}
if($(id).value){$(id).value+="\n";}
$(id).value+=transport.responseText;}
clear();$('quickreply_multi_mention').hide();$('mentioned_ids').value='all';if(spinner){spinner.destroy();spinner='';}
$(id).focus();}
function clear(){var element,post_ids,mentioned=Cookie.get("multi_mention");$('quickreply_multi_mention').hide();if(mentioned){post_ids=mentioned.split("|");post_ids.each(function(post_id){if($("multi_mention_"+post_id)){element=$("multi_mention_"+post_id);element.src=element.src.replace("postbit_multi_mention_on.gif","postbit_multi_mention.gif");}
if($("multi_mention_link_"+post_id)){element=$("multi_mention_link_"+post_id);element.removeClassName('postbit_multimention_on');}});}
Cookie.unset('multi_mention');}
m.multi={init:init,load:load,clear:clear,mention:mention,};return m;})(MentionMe||{});Event.observe(document,'dom:loaded',MentionMe.multi.init);